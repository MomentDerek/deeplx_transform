version: '3.8'

services:
  deeplx-transform:
    build: .
    container_name: ${CONTAINER_NAME:-deeplx-transform}
    ports:
      - "${HOST_PORT:-8080}:${CONTAINER_PORT:-8080}"
    environment:
      - GIN_MODE=${GIN_MODE:-release}
      # 可以通过环境变量覆盖配置
      - TARGET_BASE_URL=${TARGET_BASE_URL:-}
    volumes:
      # 挂载配置文件，方便修改
      - ./config.yaml:/root/config.yaml
    restart: ${RESTART_POLICY:-unless-stopped}
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3